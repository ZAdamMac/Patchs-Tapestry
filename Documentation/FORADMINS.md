# Tapestry Specialist Backup Tool - Admin Documentation
*Special-Use Documentation, prepared for Version 2.0.2*

The purpose of this document is to dive a little deeper into some of the security and configuration considerations of Tapestry. If you are a power user or deploying organizationally, this guide is for you. Basic information on configuration flags is found in `FORUSERS.md`

## Full System Requirements
Tapestry is a reasonably lightweight and flexible script in its essence, but it does involve some basic requirements.

**Suggested Minimum Hardware Requirements**
- 4 GB RAM (Probably will run in less)
- 3.0 GHz, 64-Bit Dual-Core Processor (or equivalent)
- 10 GB or more unusued Hard Drive Space 

**Software Requirements**
- Python v3.5 or Later
- Python-GnuPG, v.0.4.2 or later
- GnuPG 2.1.11 or Later
- Paramiko

These software requirements will now automatically be installed when installing via Pip.

## Key Security Considerations
All of Tapestry's security relies on the security of the PGP protocol, GnuPG's implementation of it, the pinentry binary currently assigned to GPG, and the cryptographic viability of the Disaster Recovery and Signing Keys.

### Securing Upper Dependancies
Tapestry and its development team have no input on the security of any of our upstream dependancies. However, we do monitor the security mailing lists for Python, Python-GnuPG, and GnuPG. Any vulnerabilities we find that can be patched downstream in Tapestry itself we will do so.

### Key Security Considerations
#### Key Storage
Tapestry expects to find the keys it is looking for on the default gnupg keyring, found under `~/.gnupg/`. There is currently no plan in the works to change this. However, this *does not* mean that the private key need be stored locally - only the public key needs to be on GPG's keyring, which is achievable for two reasons:
1. The Disaster Recovery Key's private portion is only needed to unpack during `--rcv` operations and is unnecessary the rest of the time.
2. The signing key, while necessary, has been validated in testing to be compatible with use in a smart card system.

This means that as long as the public portion of the key is on the key ring, GnuPG will intelligently look for the key on any available smart card devices (such as a compatible version of YubiKey or an OpenPGP smart card) to execute the relevant operation.

That said, even if the private portions of the keys are not being stored locally to the machine, backups should exist on physical media *somewhere* where they can be retrieved. The loss of access to a DR key means loss of access to the backups Tapestry generates.

The Use Case #1, above, is especially usable in an organizational setting, where it may be desirable to have several work stations recover to the same DR key, with the IT Services Team in some way in possession of that key.

#### Changing Key Size
As a general rule, RSA with 2048-bit keys is considered secure through 2030. If you expect to keep your backups longer than this period of time, you can select a larger key size using the `keysize` variable in your config file and regenerating the key.

Tapestry will accept whatever key fingerprint it is pointed at - this step is only required if allowing Tapestry to generate its own Disaster Recovery key.

#### Generating Your Own Keys
The assumption is already made that a Tapestry user is capable of generating their own keys - this is why the applet does not create a signing key during the `--genKey` operation.

As long as GPG would accept your key, you can create keys of any parameters and provide them in your config file by indicating the full fingerprint to use for each of `expected fp` (Disaster Recovery) and `signing fp`.

#### Long Term Management of Keys
**Key Expiry** is a good consideration for signing keys in particular. If your organization has internal requirements, follow them - Tapestry is largely agnostic. However, if you are looking for a guideline, we typically recommend key expiry after one year for all signing keys, which can be extended if still in control and under active use.

**Revocation Certificates** are especially critical for the Disaster Recovery Key. They are not generated by default, and should be generated using GPG if the disaster recovery key will be shared among multiple machines. This can be used to bulk-disable the writing of new tapestry backups to a given disaster recovery key if the DR key is compromised in any way. A key that has expired or been revoked can still be used to decrypt tapfiles, but can no longer be used for signing or encryption of new files.

## Notes on File Selection
Tapestry runs at the permission level of the user who calls it - this can cause issues if that user does not have access to all directories and files that are located under a target path. For this reason, Tapestry is principally recommended as a file/documentary backup tool first and foremost.

## Block Size vs Compression Level
Tapestry exports its final output files as ascii-armored GPG messages for compatibility reasons. This means that an output file has a high chance of being larger than the config-defined block size, particularly if compression is not in use, or the compression level is set inappropriately low.

Unfortunately, for the time being, there is no linearity to this transform. Getting the right balance of blocksize and compression level has many variables and might rely on some experimentation depending on how strictly you need to stay under the blocksize.

## Example Uses of Tapestry in Organizational Arrangements

### Alice and Bob's Cafe
**An Example of a SOHO Application**

Alice and Bob run a small downtown cafe and manage its operations in an on-site office. They have two seperate computing systems:
- A POS server that hosts their restaurant management software, and;
- A workstation where Alice does all of the accounting, HR, comms, and other important work not handled by the server.

After Bob leaves a fryer on overnight, both are concerned about the possibility of losing the business, and what it would mean. Also, being downtown, there is always the risk of a break-in. Alice, being cautious and savvy, realizes that they could at least keep backups of their important records offsite - writing them to DVDs to store at their home. Bob points out that this is also subject to break-in, and what's more, they spend more time at work than at home. Alice and Bob need a way to store these backups at their home and know they won't be read inadvertantly by their stay-at-home daughter Mallory, who sometimes likes to snoop.

#### Is Tapestry Appropriate?

It's not *inappropriate*. Tapestry checks several of Alice and Bob's boxes, but not all of them. It also allows an assurance that the records are neither read nor tampered with once they are stored wherever they are ultimately stored. The physical location is irrelevant - and Alice is right that the location should be physically removed from her business.

#### How we'd deploy that:
**The Disaster Recovery Key** could be generated on either computer, but the private portion should be removed from the key ring once it's backed up, ideally to removable media that is stored somewhere securely. If the restaurant's safe is fire proof, that could be a good place. An anchored, locked container at Alice and Bob's house would be better. Both computers need the public key installed.

**Use the compID** value in configuration to distinguish between backups from the POS server and the workstation.

The choice of DVDs is a little unusual - there's not really a good reason to. This could be achieved using BlockSize and Compression appropriately. That won't cause Tapestry to write to the disk, necessarily - unless the OS allowed this for some reason.

I would use at-runtime signing for this client. That'll leave a prompt on the screen when it runs, asking for the passphrase for the signing key. Since these keys aren't likely to be used for anything else, they could probably just live right on the two computers.

Simple automation using a windows scheduled task pointed at the right command line argument would also suffice in this case. As for what to back up, I'd pull the critical business documents off the workstation and the generated reports off the POS system every month, then run `--inc` every three months to back up the POS's database itself.

### Alice and Bob LLC
Alice and Bob are consultants in downtown Anywhere, with a beautiful street-level firm. They employ a half dozen clerks and other functionaries who all have dedicated workstations. Bob, an unrepentant gadget hound, contracts with SomeVendor to provide cloud storage and other services (email, for instance).

After Competitor Partners LLC gets robbed four blocks over, Alice and Bob's insurance adjustors send out an email warning them that they should have a disaster recovery plan that includes offsite backup. No problem, says Bob. We'll throw everything important in a SomeVendor bucket (whatever that means)

### Is Tapestry Appropriate Here?
Absolutely. Tapestry's general use case is offsite file backup for a small organization.

### How would we delpoy this?
Bob being the gadget hound he is, he's already worked with GuardDog Security, the hometown cybersecurity firm, to set up SSO for his users, and this SSO is based on hardware tokens, to provide the most security possible for the client information that often lives on these machines.

The hardware tokens allow a secondary app mode to store an OpenPGP key. My recommendation here would be to generate each user a signing key and put it on those tokens, requiring them (and them specifically) to set their own signing PINs.

The Disaster Recovery Key should be generated on a known-clean, offline machine - perhaps launched using a live distro - and the public portion installed on every system to be backed up. In this situation I would also leave automatic signing on, and sechedule the job to run maybe an hour or so before everyone is expected to enter the office on, say, the first monday of the month.

### AB International Inc.
Fine providers of literally every widgetistor in production.

#### Is Tapestry Appropriate in This Use Case?
Probably not, at least not in any kind of global way. There is currently a lot of management and deployment framework missing.